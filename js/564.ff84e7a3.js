(self["webpackChunkunicorn_banners"]=self["webpackChunkunicorn_banners"]||[]).push([[564],{4019:function(t){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},3403:function(t,e,i){"use strict";var n,s,r,a=i(4019),o=i(9781),h=i(7854),l=i(614),c=i(111),u=i(2597),d=i(648),m=i(6330),g=i(8880),p=i(1320),f=i(3070).f,y=i(7976),v=i(9518),b=i(7674),w=i(5112),x=i(9711),S=h.Int8Array,T=S&&S.prototype,A=h.Uint8ClampedArray,E=A&&A.prototype,P=S&&v(S),R=T&&v(T),L=Object.prototype,k=h.TypeError,z=w("toStringTag"),C=x("TYPED_ARRAY_TAG"),B=x("TYPED_ARRAY_CONSTRUCTOR"),M=a&&!!b&&"Opera"!==d(h.opera),_=!1,D={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},W={BigInt64Array:8,BigUint64Array:8},H=function(t){if(!c(t))return!1;var e=d(t);return"DataView"===e||u(D,e)||u(W,e)},N=function(t){if(!c(t))return!1;var e=d(t);return u(D,e)||u(W,e)},F=function(t){if(N(t))return t;throw k("Target is not a typed array")},I=function(t){if(l(t)&&(!b||y(P,t)))return t;throw k(m(t)+" is not a typed array constructor")},U=function(t,e,i,n){if(o){if(i)for(var s in D){var r=h[s];if(r&&u(r.prototype,t))try{delete r.prototype[t]}catch(a){try{r.prototype[t]=e}catch(l){}}}R[t]&&!i||p(R,t,i?e:M&&T[t]||e,n)}},O=function(t,e,i){var n,s;if(o){if(b){if(i)for(n in D)if(s=h[n],s&&u(s,t))try{delete s[t]}catch(r){}if(P[t]&&!i)return;try{return p(P,t,i?e:M&&P[t]||e)}catch(r){}}for(n in D)s=h[n],!s||s[t]&&!i||p(s,t,e)}};for(n in D)s=h[n],r=s&&s.prototype,r?g(r,B,s):M=!1;for(n in W)s=h[n],r=s&&s.prototype,r&&g(r,B,s);if((!M||!l(P)||P===Function.prototype)&&(P=function(){throw k("Incorrect invocation")},M))for(n in D)h[n]&&b(h[n],P);if((!M||!R||R===L)&&(R=P.prototype,M))for(n in D)h[n]&&b(h[n].prototype,R);if(M&&v(E)!==R&&b(E,R),o&&!u(R,z))for(n in _=!0,f(R,z,{get:function(){return c(this)?this[C]:void 0}}),D)h[n]&&g(h[n],C,n);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:M,TYPED_ARRAY_CONSTRUCTOR:B,TYPED_ARRAY_TAG:_&&C,aTypedArray:F,aTypedArrayConstructor:I,exportTypedArrayMethod:U,exportTypedArrayStaticMethod:O,isView:H,isTypedArray:N,TypedArray:P,TypedArrayPrototype:R}},8544:function(t,e,i){var n=i(1068);t.exports=!n((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},9518:function(t,e,i){var n=i(7854),s=i(2597),r=i(614),a=i(7908),o=i(6200),h=i(8544),l=o("IE_PROTO"),c=n.Object,u=c.prototype;t.exports=h?c.getPrototypeOf:function(t){var e=a(t);if(s(e,l))return e[l];var i=e.constructor;return r(i)&&e instanceof i?i.prototype:e instanceof c?u:null}},4590:function(t,e,i){var n=i(7854),s=i(3002),r=n.RangeError;t.exports=function(t,e){var i=s(t);if(i%e)throw r("Wrong offset");return i}},3002:function(t,e,i){var n=i(7854),s=i(9303),r=n.RangeError;t.exports=function(t){var e=s(t);if(e<0)throw r("The argument can't be less than 0");return e}},8675:function(t,e,i){"use strict";var n=i(3403),s=i(6244),r=i(9303),a=n.aTypedArray,o=n.exportTypedArrayMethod;o("at",(function(t){var e=a(this),i=s(e),n=r(t),o=n>=0?n:i+n;return o<0||o>=i?void 0:e[o]}))},3462:function(t,e,i){"use strict";var n=i(7854),s=i(6916),r=i(3403),a=i(6244),o=i(4590),h=i(7908),l=i(1068),c=n.RangeError,u=n.Int8Array,d=u&&u.prototype,m=d&&d.set,g=r.aTypedArray,p=r.exportTypedArrayMethod,f=!l((function(){var t=new Uint8ClampedArray(2);return s(m,t,{length:1,0:3},1),3!==t[1]})),y=f&&r.NATIVE_ARRAY_BUFFER_VIEWS&&l((function(){var t=new u(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));p("set",(function(t){g(this);var e=o(arguments.length>1?arguments[1]:void 0,1),i=h(t);if(f)return s(m,this,i,e);var n=this.length,r=a(i),l=0;if(r+e>n)throw c("Wrong length");while(l<r)this[e+l]=i[l++]}),!f||y)},2613:function(t,e,i){i(2801),i(8675),i(3462),function(e){"use strict";var i=b(),n=w(),s=x(),r=S(),a={imagePlaceholder:void 0,cacheBust:!1},o={toSvg:h,toPng:c,toJpeg:u,toBlob:d,toPixelData:l,impl:{fontFaces:s,images:r,util:i,inliner:n,options:{}}};function h(t,e){return e=e||{},m(e),Promise.resolve(t).then((function(t){return p(t,e.filter,!0)})).then(f).then(y).then(n).then((function(n){return v(n,e.width||i.width(t),e.height||i.height(t))}));function n(t){return e.bgcolor&&(t.style.backgroundColor=e.bgcolor),e.width&&(t.style.width=e.width+"px"),e.height&&(t.style.height=e.height+"px"),e.style&&Object.keys(e.style).forEach((function(i){t.style[i]=e.style[i]})),t}}function l(t,e){return g(t,e||{}).then((function(e){return e.getContext("2d").getImageData(0,0,i.width(t),i.height(t)).data}))}function c(t,e){return g(t,e||{}).then((function(t){return t.toDataURL()}))}function u(t,e){return e=e||{},g(t,e).then((function(t){return t.toDataURL("image/jpeg",e.quality||1)}))}function d(t,e){return g(t,e||{}).then(i.canvasToBlob)}function m(t){"undefined"===typeof t.imagePlaceholder?o.impl.options.imagePlaceholder=a.imagePlaceholder:o.impl.options.imagePlaceholder=t.imagePlaceholder,"undefined"===typeof t.cacheBust?o.impl.options.cacheBust=a.cacheBust:o.impl.options.cacheBust=t.cacheBust}function g(t,e){return h(t,e).then(i.makeImage).then(i.delay(100)).then((function(e){var i=n(t);return i.getContext("2d").drawImage(e,0,0),i}));function n(t){var n=document.createElement("canvas");if(n.width=e.width||i.width(t),n.height=e.height||i.height(t),e.bgcolor){var s=n.getContext("2d");s.fillStyle=e.bgcolor,s.fillRect(0,0,n.width,n.height)}return n}}function p(t,e,n){return n||!e||e(t)?Promise.resolve(t).then(s).then((function(i){return r(t,i,e)})).then((function(e){return a(t,e)})):Promise.resolve();function s(t){return t instanceof HTMLCanvasElement?i.makeImage(t.toDataURL()):t.cloneNode(!1)}function r(t,e,n){var s=t.childNodes;return 0===s.length?Promise.resolve(e):r(e,i.asArray(s),n).then((function(){return e}));function r(t,e,i){var n=Promise.resolve();return e.forEach((function(e){n=n.then((function(){return p(e,i)})).then((function(e){e&&t.appendChild(e)}))})),n}}function a(t,e){return e instanceof Element?Promise.resolve().then(n).then(s).then(r).then(a).then((function(){return e})):e;function n(){function n(t,e){function n(t,e){i.asArray(t).forEach((function(i){e.setProperty(i,t.getPropertyValue(i),t.getPropertyPriority(i))}))}t.cssText?e.cssText=t.cssText:n(t,e)}n(window.getComputedStyle(t),e.style)}function s(){function n(n){var s=window.getComputedStyle(t,n),r=s.getPropertyValue("content");if(""!==r&&"none"!==r){var a=i.uid();e.className=e.className+" "+a;var o=document.createElement("style");o.appendChild(h(a,n,s)),e.appendChild(o)}function h(t,e,n){var s="."+t+":"+e,r=n.cssText?a(n):o(n);return document.createTextNode(s+"{"+r+"}");function a(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function o(t){return i.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}}[":before",":after"].forEach((function(t){n(t)}))}function r(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function a(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach((function(t){var i=e.getAttribute(t);i&&e.style.setProperty(t,i)})))}}}function f(t){return s.resolveAll().then((function(e){var i=document.createElement("style");return t.appendChild(i),i.appendChild(document.createTextNode(e)),t}))}function y(t){return r.inlineAll(t).then((function(){return t}))}function v(t,e,n){return Promise.resolve(t).then((function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)})).then(i.escapeXhtml).then((function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"})).then((function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+n+'">'+t+"</svg>"})).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))}function b(){return{escape:d,parseExtension:e,mimeType:i,dataAsUrl:u,isDataUrl:n,canvasToBlob:r,resolveUrl:a,getAndEncode:c,uid:h(),delay:m,asArray:g,escapeXhtml:p,makeImage:l,width:f,height:y};function t(){var t="application/font-woff",e="image/jpeg";return{woff:t,woff2:t,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:e,jpeg:e,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function e(t){var e=/\.([^\.\/]*?)$/g.exec(t);return e?e[1]:""}function i(i){var n=e(i).toLowerCase();return t()[n]||""}function n(t){return-1!==t.search(/^(data:)/)}function s(t){return new Promise((function(e){for(var i=window.atob(t.toDataURL().split(",")[1]),n=i.length,s=new Uint8Array(n),r=0;r<n;r++)s[r]=i.charCodeAt(r);e(new Blob([s],{type:"image/png"}))}))}function r(t){return t.toBlob?new Promise((function(e){t.toBlob(e)})):s(t)}function a(t,e){var i=document.implementation.createHTMLDocument(),n=i.createElement("base");i.head.appendChild(n);var s=i.createElement("a");return i.body.appendChild(s),n.href=e,s.href=t,s.href}function h(){var t=0;return function(){return"u"+e()+t++;function e(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function l(t){return new Promise((function(e,i){var n=new Image;n.onload=function(){e(n)},n.onerror=i,n.src=t}))}function c(t){var e=3e4;return o.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime()),new Promise((function(i){var n,s=new XMLHttpRequest;if(s.onreadystatechange=a,s.ontimeout=h,s.responseType="blob",s.timeout=e,s.open("GET",t,!0),s.send(),o.impl.options.imagePlaceholder){var r=o.impl.options.imagePlaceholder.split(/,/);r&&r[1]&&(n=r[1])}function a(){if(4===s.readyState)if(200===s.status){var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];i(t)},e.readAsDataURL(s.response)}else n?i(n):l("cannot fetch resource: "+t+", status: "+s.status)}function h(){n?i(n):l("timeout of "+e+"ms occured while fetching resource: "+t)}function l(t){console.error(t),i("")}}))}function u(t,e){return"data:"+e+";base64,"+t}function d(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function m(t){return function(e){return new Promise((function(i){setTimeout((function(){i(e)}),t)}))}}function g(t){for(var e=[],i=t.length,n=0;n<i;n++)e.push(t[n]);return e}function p(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")}function f(t){var e=v(t,"border-left-width"),i=v(t,"border-right-width");return t.scrollWidth+e+i}function y(t){var e=v(t,"border-top-width"),i=v(t,"border-bottom-width");return t.scrollHeight+e+i}function v(t,e){var i=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(i.replace("px",""))}}function w(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:r,shouldProcess:e,impl:{readUrls:n,inline:s}};function e(e){return-1!==e.search(t)}function n(e){var n,s=[];while(null!==(n=t.exec(e)))s.push(n[1]);return s.filter((function(t){return!i.isDataUrl(t)}))}function s(t,e,n,s){return Promise.resolve(e).then((function(t){return n?i.resolveUrl(t,n):t})).then(s||i.getAndEncode).then((function(t){return i.dataAsUrl(t,i.mimeType(e))})).then((function(i){return t.replace(r(e),"$1"+i+"$3")}));function r(t){return new RegExp("(url\\(['\"]?)("+i.escape(t)+")(['\"]?\\))","g")}}function r(t,i,r){return a()?Promise.resolve(t):Promise.resolve(t).then(n).then((function(e){var n=Promise.resolve(t);return e.forEach((function(t){n=n.then((function(e){return s(e,t,i,r)}))})),n}));function a(){return!e(t)}}}function x(){return{resolveAll:t,impl:{readAll:e}};function t(){return e(document).then((function(t){return Promise.all(t.map((function(t){return t.resolve()})))})).then((function(t){return t.join("\n")}))}function e(){return Promise.resolve(i.asArray(document.styleSheets)).then(e).then(t).then((function(t){return t.map(s)}));function t(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return n.shouldProcess(t.style.getPropertyValue("src"))}))}function e(t){var e=[];return t.forEach((function(t){try{i.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(n){console.log("Error while reading CSS rules from "+t.href,n.toString())}})),e}function s(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return n.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}function S(){return{inlineAll:e,impl:{newImage:t}};function t(t){return{inline:e};function e(e){return i.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||i.getAndEncode).then((function(e){return i.dataAsUrl(e,i.mimeType(t.src))})).then((function(e){return new Promise((function(i,n){t.onload=i,t.onerror=n,t.src=e}))}))}}function e(s){return s instanceof Element?r(s).then((function(){return s instanceof HTMLImageElement?t(s).inline():Promise.all(i.asArray(s.childNodes).map((function(t){return e(t)})))})):Promise.resolve(s);function r(t){var e=t.style.getPropertyValue("background");return e?n.inlineAll(e).then((function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))})).then((function(){return t})):Promise.resolve(t)}}}t.exports=o}()},62:function(t,e,i){"use strict";i.d(e,{i:function(){return c}});var n=i(4301),s=i(3396),r=i(2037),a=i(5553);const o=t=>"[object Object]"===Object.prototype.toString.call(t);i(8675),i(3462);let h=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce(((t,e)=>(e&=63,t+=e<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_",t)),"");const l=(0,a.x)(),c=(0,n.Q_)("banners",{state:()=>({banners:{data:[],status:"",error:""},banner:{data:{conversion:"",userGroup:null,category:null,canvases:[{title:"Insta Post (Ads)",width:1080,height:1080,layers:{},schemes:{}},{title:"Stories (Ads)",width:1080,height:1920,layers:{},schemes:{}},{title:"Fb / Youtube / Email",width:1280,height:720,layers:{},schemes:{}}],layers:[],schemes:[],files:[]},status:"",error:""},listFontFamily:[{label:"Gilroy",value:'"Gilroy", sans-serif'},{label:"Proxima Nova",value:'"Proxima Nova", sans-serif'},{label:"Montserrat",value:'"Montserrat", sans-serif'},{label:"Bebas Neue",value:'"Bebas Neue", sans-serif'},{label:"Microsoft Sans Serif",value:'"Microsoft Sans Serif", sans-serif'},{label:"Nanum Pen",value:'"Nanum Pen", cursive'},{label:"Bodoni",value:'"Bodoni", serif'}],listFontWeight:[{label:"Thin",value:100},{label:"Extra Light",value:200},{label:"Light",value:300},{label:"Normal",value:400},{label:"Medium",value:500},{label:"Semi Bold",value:600},{label:"Bold",value:700},{label:"Extra Bold",value:800},{label:"Black",value:900}],listImageShapes:[{label:"Прямоугольная",value:"rectangle"},{label:"Круглая",value:"circle"}],listUserGroups:[{label:"Для всех",value:"all"},{label:"Для premium",value:"premium"}],copyrightTypes:["light","transparent","dark"],currentSchemeId:"",currentCanvasId:0,selectedColorScheme:null}),getters:{listCategories(){return l.categories.data.map((({id:t,name:e})=>({label:e,value:t})))},canvases(){return this.banner.data.canvases},canvas(){return this.canvases[this.currentCanvasId]},schemes(){return this.banner.data.schemes},layers(){return this.banner.data.layers},files(){return this.banner.data.files},activeLayer(){return this.layers.find((t=>t.isActive))||{}}},actions:{async getBanners(){this.banners.status="loading";try{const{data:t}=await r.Z.banners.get();return this.banners.data=t.banners.map((t=>(t.data={conversion:t.conversion,userGroup:t.is_premium?this.listUserGroups[1]:this.listUserGroups[0],category:this.listCategories.find((e=>e.value===t.category_id)),schemes:t.data?.schemes||[],canvases:t.data?.canvases||[],layers:t.data?.layers||[],files:t.files||[]},t))),this.banners.status="success",this.banners.error=null,Promise.resolve()}catch(t){return this.banners.status="error",this.banners.error=t,Promise.reject(t)}},async getBanner(t){this.banner.status="loading";try{const{data:e}=await r.Z.banners.get(t);return e.data?.canvases?.forEach((t=>{o(t.layers)||(t.layers={})})),this.banner.data={conversion:e.conversion,userGroup:e.is_premium?this.listUserGroups[1]:this.listUserGroups[0],category:this.listCategories.find((t=>t.value===e.category_id)),schemes:e.data?.schemes||[],canvases:e.data?.canvases||[],layers:e.data?.layers||[],files:e.files||[]},this.layers.forEach((t=>{"text"===t.type&&this.addTextLayerGetterSetter(t)})),this.currentSchemeId=this.banner.data.schemes[0]?.id,this.banner.status="success",this.banner.error=null,Promise.resolve()}catch(e){return this.banner.status="error",this.banner.error=e,Promise.reject(e)}},async createBanner(t){try{const{data:e}=await r.Z.banners.create(t);return Promise.resolve(e)}catch(e){return Promise.reject(e)}},async updateBanner(t){try{const{data:e}=await r.Z.banners.update(t);return Promise.resolve(e)}catch(e){return Promise.reject(e)}},async deleteBanner(t){try{const{data:e}=await r.Z.banners["delete"](t);return Promise.resolve(e)}catch(e){return Promise.reject(e)}},async restoreBanner(t){try{const{data:e}=await r.Z.banners.restore(t);return Promise.resolve(e)}catch(e){return Promise.reject(e)}},addTextLayerGetterSetter(t){Object.defineProperty(t,"text",{get(){return this._text},set(t){this._text=t?.slice(0,this.textLimit||void 0)}}),Object.defineProperty(t,"textLimit",{get(){return this._textLimit},set(t){this._textLimit=t,this.text=this._text}})},setCanvasId(t){this.currentCanvasId=t},getWidth({id:t},e,i){return e.layers[t].width??i.canvases[0].layers[t].width??100},getHeight({id:t},e,i){return e.layers[t].height??i.canvases[0].layers[t].height??100},getTopOffset({id:t},e,i){return e.layers[t].top??i.canvases[0].layers[t].top??10},getLeftOffset({id:t},e,i){return e.layers[t].left??i.canvases[0].layers[t].left??i.canvases[0].width/2-50},getImage(t,e,i){const n=i||e.schemes[0].id;return this.getFile(t.schemes[n].image)||{}},getImageShape({id:t},e,i){return e.layers[t].shape??i.canvases[0].layers[t].shape??this.listImageShapes[0]},getBorderRadius({id:t},e,i){return e.layers[t].borderRadius??i.canvases[0].layers[t].borderRadius??0},getFontSize({id:t},e,i){return e.layers[t].fontSize??i.canvases[0].layers[t].fontSize??16},getFontColor({id:t},e,i,n){const s=n||i.schemes[0].id;return e.layers[t].schemes[s].fontColor??i.canvases[0].layers[t].schemes[s].fontColor??"#000000"},getFontFamily({id:t},e,i){return e.layers[t].fontFamily??i.canvases[0].layers[t].fontFamily??this.listFontFamily[0]},getFontWeight({id:t},e,i){return e.layers[t].fontWeight??i.canvases[0].layers[t].fontWeight??this.listFontWeight[3]},getTextAlign({id:t},e,i){return e.layers[t].textAlign??i.canvases[0].layers[t].textAlign??"left"},getTextVerticalAlign({id:t},e,i){return e.layers[t].textVerticalAlign??i.canvases[0].layers[t].textVerticalAlign??"flex-start"},getLineHeight({id:t},e,i){return e.layers[t].lineHeight??i.canvases[0].layers[t].lineHeight??110},getLetterSpacing({id:t},e,i){return e.layers[t].letterSpacing??i.canvases[0].layers[t].letterSpacing??0},getRotation({id:t},e,i){return e.layers[t].rotate??i.canvases[0].layers[t].rotate??0},getCopyrightType(t,e,i){const n=i||e.schemes[0].id;return t.schemes[n].copyright||e.canvases[0].schemes[n].copyright||this.copyrightTypes[0]},getBackgroundStyle(t,e,i){const n=i||e.schemes[0].id,s=this.getFile(e,t.schemes[n]?.background);return s.url?`url(${s.url})`:null},getBackgroundWithTextStyle(t,e,i){const n=i||e.schemes[0].id,s=this.getFile(e,t.schemes[n]?.backgroundWithText);return s.url?`url(${s.url})`:null},setTitle(t,e){t.title=e},setLeftOffset({id:t},e){this.canvas.layers[t].left=Number(e.target.value)},setTopOffset({id:t},e){this.canvas.layers[t].top=Number(e.target.value)},setWidth({id:t},e){this.canvas.layers[t].width=Number(e.target.value)},setHeight({id:t},e){this.canvas.layers[t].height=Number(e.target.value)},setFontFamily({id:t},e){this.canvas.layers[t].fontFamily=e},setFontWeight({id:t},e){this.canvas.layers[t].fontWeight=e},setFontSize({id:t},e){this.canvas.layers[t].fontSize=e.target.value},setFontColor({id:t},e){const i=this.canvas.layers[t];i.schemes[this.currentSchemeId].fontColor=e.hex||e.target.value},setLineHeight({id:t},e){this.canvas.layers[t].lineHeight=e.target.value},setLetterSpacing({id:t},e){this.canvas.layers[t].letterSpacing=e.target.value},setTextAlign({id:t},e){this.canvas.layers[t].textAlign=e.target.value},setTextVerticalAlign({id:t},e){this.canvas.layers[t].textVerticalAlign=e.target.value},setImageShape({id:t},e){const i=this.canvas.layers[t];if("circle"===e.value){const{width:t,height:e}=i;t>e?i.width=e:i.height=t}(0,s.Y3)((()=>{i.shape=e}))},setBorderRadius({id:t},e){this.canvas.layers[t].borderRadius=e.target.value},setRotation({id:t},e){this.canvas.layers[t].rotate=e.target.value},setUserGroup(t){this.banner.userGroup=this.listUserGroups[t]},addColorScheme(t,e){const i=this.schemes[0]?.id,n=h();this.schemes.push({id:n,...t}),i?this.canvases.forEach((t=>{const e=JSON.parse(JSON.stringify(t.schemes[i]));t.schemes[n]={...e},this.layers.forEach((e=>{const s=JSON.parse(JSON.stringify(e.schemes[i]));e.schemes[n]={...s};const r=t.layers[e.id],a=JSON.parse(JSON.stringify(r.schemes[i]));r.schemes[n]={...a}}))})):this.canvases.forEach((t=>{t.schemes[n]={background:"",backgroundWithText:""}})),this.switchColorScheme(n),e&&(0,s.Y3)((()=>{e.scrollTo(e.scrollWidth,0)}))},updateColorScheme(t){const e=this.schemes.find((e=>e.id===t.id));e.color=t.color,e.usedColors=t.usedColors},switchColorScheme(t){this.currentSchemeId=t},selectColorScheme(t){this.selectedColorScheme=this.schemes.find((e=>e.id===t))},getColorScheme(t){return this.schemes.find((e=>e.id===t))||{}},addFile(t){this.files.push(t)},deleteFile(t){const e=[],i=this.files.find((e=>e.id===t));if(!i)return;this.canvases.forEach((t=>{Object.entries(t.schemes).forEach((([,t])=>{t.background&&e.push(t.background),t.backgroundWithText&&e.push(t.backgroundWithText)}))})),this.layers.forEach((t=>{Object.entries(t.schemes).forEach((([,t])=>{t.image&&e.push(t.image)}))}));const n=e.filter((e=>e===t));0===n.length&&this.files.splice(this.files.indexOf(i),1)},getFile(t,e){return t.files.find((t=>t.id===e))||{}},addLayer(t){const e=h(),i={type:t,id:e,schemes:{}},n={width:null,height:null,top:null,left:null,rotate:null,schemes:{}};switch(t){case"image":this.schemes.forEach((t=>{i.schemes[t.id]={image:""},n.schemes[t.id]={}})),i.title="Изображение",n.shape=null,n.lockAspectRatio=!1;break;case"text":this.schemes.forEach((t=>{i.schemes[t.id]={},n.schemes[t.id]={fontColor:null}})),i._text="Ваш текст большой",i._textLimit="",i.title="",n.fontFamily=null,n.fontWeight=null,n.fontSize=null,n.lineHeight=null,n.letterSpacing=null,n.textAlign=null,n.textVerticalAlign=null,this.addTextLayerGetterSetter(i);break;default:break}this.layers.unshift(i),this.canvases.forEach((t=>{t.layers[e]=JSON.parse(JSON.stringify(n))})),this.activateLayer(i)},deleteLayer(t){const e=this.layers.findIndex((e=>e.id===t.id));this.layers.splice(e,1),this.canvases.forEach((e=>{delete e.layers[t.id]})),this.activateLayer(this.layers[0])},positionLayer(t,e){const i=this.activeLayer;this.canvas.layers[i.id].top=e,this.canvas.layers[i.id].left=t},resizeLayer(t,e,i,n){const s=this.activeLayer;this.canvas.layers[s.id].width=i,this.canvas.layers[s.id].height=n,this.canvas.layers[s.id].top=e,this.canvas.layers[s.id].left=t},activateLayer(t){this.layers.forEach((e=>{e.isActive=e.id===t.id}))},deactivateLayer(t){t.isActive=!1},shiftLayer(t,e,i){const n=this.canvas.layers[t.id],s=i?10:1,r=this.getLeftOffset(t),a=this.getTopOffset(t);switch(e){case"up":n.top=a-s;break;case"right":n.left=r+s;break;case"down":n.top=a+s;break;case"left":n.left=r-s;break;default:break}},updateImage(t,e){const i=t.schemes[this.currentSchemeId],n=i.image;i.image=e?.id,this.addFile(e),this.deleteFile(n)},updateBackground(t){const e=this.canvas.schemes[this.currentSchemeId],i=e.background;e.background=t?.id,this.addFile(t),this.deleteFile(i)},updateBackgroundWithText(t){const e=this.canvas.schemes[this.currentSchemeId],i=e.backgroundWithText;e.backgroundWithText=t?.id,this.addFile(t),this.deleteFile(i)},resetState(){this.currentSchemeId="",this.currentCanvasId=0,this.banner.status="",this.banner.error="";const t=this.banner.data;t.conversion="",t.userGroup=null,t.category=null,t.layers=[],t.schemes=[],t.files=[],t.canvases.forEach((t=>{t.layers={},t.schemes={}}))}}})},5995:function(t,e,i){"use strict";i.d(e,{Z:function(){return N}});var n=i(3396),s=i(7139),r=i(9242);const a={class:"canvas",ref:"canvas"},o={key:0,class:"canvas_image_placeholder"},h=["src"],l={class:"canvas_text_wrapper"},c=["onUpdate:modelValue","disabled"],u={ref:"preload",class:"canvas_preload"};function d(t,e,i,d,m,g){const p=(0,n.up)("AppIcon"),f=(0,n.up)("VueDraggableResizable"),y=(0,n.up)("BannerCopyright");return(0,n.wg)(),(0,n.iD)("div",{class:"canvas_wrapper",style:(0,s.j5)({"--zoom":i.zoom,"--canvas-width":`${i.canvas.width}px`,"--canvas-height":`${i.canvas.height}px`})},[(0,n._)("div",a,[(0,n._)("div",{class:"canvas_bg",style:(0,s.j5)({"--background":d.bannersStore.getBackgroundStyle(i.canvas,i.banner,i.scheme),"--background-with-text":d.bannersStore.getBackgroundWithTextStyle(i.canvas,i.banner,i.scheme)})},null,4),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(g.layers,(a=>((0,n.wg)(),(0,n.j4)(f,{key:a.id,draggable:i.editable,resizable:i.editable,w:d.bannersStore.getWidth(a,i.canvas,i.banner),h:d.bannersStore.getHeight(a,i.canvas,i.banner),y:d.bannersStore.getTopOffset(a,i.canvas,i.banner),x:d.bannersStore.getLeftOffset(a,i.canvas,i.banner),minh:0,minw:0,scale:i.zoom,lockAspectRatio:"circle"===d.bannersStore.getImageShape(a,i.canvas,i.banner).value,active:a.isActive,"onUpdate:active":t=>a.isActive=t,onResizing:d.bannersStore.resizeLayer,onDragging:d.bannersStore.positionLayer,onActivated:t=>d.bannersStore.activateLayer(a),onDeactivated:t=>d.bannersStore.deactivateLayer(a),class:(0,s.C_)(["canvas_layer",{"is-disabled":!i.editable}])},{default:(0,n.w5)((()=>["image"===a.type?((0,n.wg)(),(0,n.iD)("div",{key:0,class:(0,s.C_)(["canvas_image",{"is-circle":"circle"===d.bannersStore.getImageShape(a,i.canvas,i.banner).value}]),style:(0,s.j5)({"--border-radius":`${d.bannersStore.getBorderRadius(a,i.canvas,i.banner)}px`,"--rotate":`${d.bannersStore.getRotation(a,i.canvas,i.banner)}deg`})},[d.bannersStore.getImage(a,i.banner,i.scheme).url?((0,n.wg)(),(0,n.iD)("img",{key:1,class:"canvas_image_picture",src:d.bannersStore.getImage(a,i.banner,i.scheme).url},null,8,h)):((0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(p,{icon:"gallery"})]))],6)):(0,n.kq)("",!0),"text"===a.type?((0,n.wg)(),(0,n.iD)("div",{key:1,class:"canvas_text",style:(0,s.j5)({"--font-size":`${d.bannersStore.getFontSize(a,i.canvas,i.banner)}px`,"--font-color":d.bannersStore.getFontColor(a,i.canvas,i.banner,i.scheme),"--font-family":d.bannersStore.getFontFamily(a,i.canvas,i.banner).value,"--font-weight":d.bannersStore.getFontWeight(a,i.canvas,i.banner).value,"--text-align":d.bannersStore.getTextAlign(a,i.canvas,i.banner),"--text-vertical-align":d.bannersStore.getTextVerticalAlign(a,i.canvas,i.banner),"--line-height":d.bannersStore.getLineHeight(a,i.canvas,i.banner)/100+"em","--letter-spacing":d.bannersStore.getLetterSpacing(a,i.canvas,i.banner)/100+"em","--rotate":`${d.bannersStore.getRotation(a,i.canvas,i.banner)}deg`}),onDblclick:e[2]||(e[2]=(0,r.iM)(((...t)=>g.enterTextEditMode&&g.enterTextEditMode(...t)),["prevent","stop"]))},[(0,n._)("div",l,[(0,n._)("div",null,(0,s.zw)(a.text)+" ",1),i.editable?(0,n.wy)(((0,n.wg)(),(0,n.iD)("textarea",{key:0,rows:"1","onUpdate:modelValue":t=>a.text=t,disabled:!t.isTextEditMode,onBlur:e[0]||(e[0]=e=>t.isTextEditMode=!1),onMousedown:e[1]||(e[1]=(0,r.iM)((()=>{}),["stop"]))},null,40,c)),[[r.nr,a.text]]):(0,n.kq)("",!0)])],36)):(0,n.kq)("",!0)])),_:2},1032,["draggable","resizable","w","h","y","x","scale","lockAspectRatio","active","onUpdate:active","onResizing","onDragging","onActivated","onDeactivated","class"])))),128)),(0,n.Wm)(y,{variant:d.bannersStore.getCopyrightType(i.canvas,i.banner,i.scheme),class:"canvas_copyright"},null,8,["variant"])],512),(0,n._)("div",u,null,512)],4)}var m=i(205);const g=["onMousedown","onTouchstart"];function p(t,e,i,a,o,h){return(0,n.wg)(),(0,n.iD)("div",{style:(0,s.j5)(h.style),class:(0,s.C_)([{[i.classNameActive]:t.enabled,[i.classNameDragging]:t.dragging,[i.classNameResizing]:t.resizing,[i.classNameDraggable]:i.draggable,[i.classNameResizable]:i.resizable},i.className]),onMousedown:e[0]||(e[0]=(0,r.iM)(((...t)=>h.elementMouseDown&&h.elementMouseDown(...t)),["stop"])),onTouchstart:e[1]||(e[1]=(0,r.iM)(((...t)=>h.elementTouchDown&&h.elementTouchDown(...t)),["stop"]))},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(h.actualHandles,(e=>((0,n.wg)(),(0,n.iD)("div",{key:e,class:(0,s.C_)([i.classNameHandle,i.classNameHandle+"-"+e]),style:(0,s.j5)({display:t.enabled?"block":"none"}),onMousedown:(0,r.iM)((t=>h.handleDown(e,t)),["stop","prevent"]),onTouchstart:(0,r.iM)((t=>h.handleTouchDown(e,t)),["stop","prevent"])},[(0,n.WI)(t.$slots,e)],46,g)))),128)),(0,n.WI)(t.$slots,"default")],38)}function f(t){return"function"===typeof t||"[object Function]"===Object.prototype.toString.call(t)}function y(t,e,i,n=1){const[s,r]="number"===typeof n?[n,n]:n,a=Math.round(e/s/t[0])*t[0],o=Math.round(i/r/t[1])*t[1];return[a,o]}function v(t,e,i){return t-e-i}function b(t,e,i){return t-e-i}function w(t,e,i){return null!==e&&t<e?e:null!==i&&i<t?i:t}function x(t,e,i){let n=t;const s=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find((t=>f(n[t])));if(!f(n[s]))return!1;do{if(n[s](e))return!0;if(n===i)return!1;n=n.parentNode}while(n);return!1}function S(t){const e=window.getComputedStyle(t);return[parseFloat(e.getPropertyValue("width"),10),parseFloat(e.getPropertyValue("height"),10)]}function T(t,e,i){t&&(t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener?t.addEventListener(e,i):t["on"+e]=i)}function A(t,e,i){t&&(t.detachEvent?t.detachEvent("on"+e,i):t.removeEventListener?t.removeEventListener(e,i):t["on"+e]=null)}const E={mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"},touch:{start:"touchstart",move:"touchmove",stop:"touchend"}},P={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},R={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"};let L=E.mouse;var k={replace:!0,name:"vue-draggable-resizable",props:{className:{type:String,default:"vdr"},classNameDraggable:{type:String,default:"draggable"},classNameResizable:{type:String,default:"resizable"},classNameDragging:{type:String,default:"dragging"},classNameResizing:{type:String,default:"resizing"},classNameActive:{type:String,default:"active"},classNameHandle:{type:String,default:"handle"},disableUserSelect:{type:Boolean,default:!0},enableNativeDrag:{type:Boolean,default:!1},preventDeactivation:{type:Boolean,default:!1},active:{type:Boolean,default:!1},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},lockAspectRatio:{type:Boolean,default:!1},w:{type:[Number,String],default:200,validator:t=>"number"===typeof t?t>0:"auto"===t},h:{type:[Number,String],default:200,validator:t=>"number"===typeof t?t>0:"auto"===t},minWidth:{type:Number,default:0,validator:t=>t>=0},minHeight:{type:Number,default:0,validator:t=>t>=0},maxWidth:{type:Number,default:null,validator:t=>t>=0},maxHeight:{type:Number,default:null,validator:t=>t>=0},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:[String,Number],default:"auto",validator:t=>"string"===typeof t?"auto"===t:t>=0},handles:{type:Array,default:()=>["tl","tm","tr","mr","br","bm","bl","ml"],validator:t=>{const e=new Set(["tl","tm","tr","mr","br","bm","bl","ml"]);return new Set(t.filter((t=>e.has(t)))).size===t.length}},dragHandle:{type:String,default:null},dragCancel:{type:String,default:null},axis:{type:String,default:"both",validator:t=>["x","y","both"].includes(t)},grid:{type:Array,default:()=>[1,1]},parent:{type:Boolean,default:!1},scale:{type:[Number,Array],default:1,validator:t=>"number"===typeof t?t>0:2===t.length&&t[0]>0&&t[1]>0},onDragStart:{type:Function,default:()=>!0},onDrag:{type:Function,default:()=>!0},onResizeStart:{type:Function,default:()=>!0},onResize:{type:Function,default:()=>!0}},data:function(){return{left:this.x,top:this.y,right:null,bottom:null,width:null,height:null,widthTouched:!1,heightTouched:!1,aspectFactor:null,parentWidth:null,parentHeight:null,minW:this.minWidth,minH:this.minHeight,maxW:this.maxWidth,maxH:this.maxHeight,handle:null,enabled:this.active,resizing:!1,dragging:!1,dragEnable:!1,resizeEnable:!1,zIndex:this.z}},created:function(){this.maxWidth&&this.minWidth>this.maxWidth&&console.warn("[Vdr warn]: Invalid prop: minWidth cannot be greater than maxWidth"),this.maxWidth&&this.minHeight>this.maxHeight&&console.warn("[Vdr warn]: Invalid prop: minHeight cannot be greater than maxHeight"),this.resetBoundsAndMouseState()},mounted:function(){this.enableNativeDrag||(this.$el.ondragstart=()=>!1);const[t,e]=this.getParentSize();this.parentWidth=t,this.parentHeight=e;const[i,n]=S(this.$el);this.aspectFactor=("auto"!==this.w?this.w:i)/("auto"!==this.h?this.h:n),this.width="auto"!==this.w?this.w:i,this.height="auto"!==this.h?this.h:n,this.right=this.parentWidth-this.width-this.left,this.bottom=this.parentHeight-this.height-this.top,this.active&&this.$emit("activated"),T(document.documentElement,"mousedown",this.deselect),T(document.documentElement,"touchend touchcancel",this.deselect),T(window,"resize",this.checkParentSize)},beforeUnmount:function(){A(document.documentElement,"mousedown",this.deselect),A(document.documentElement,"touchstart",this.handleUp),A(document.documentElement,"mousemove",this.move),A(document.documentElement,"touchmove",this.move),A(document.documentElement,"mouseup",this.handleUp),A(document.documentElement,"touchend touchcancel",this.deselect),A(window,"resize",this.checkParentSize)},methods:{resetBoundsAndMouseState(){this.mouseClickPosition={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},this.bounds={minLeft:null,maxLeft:null,minRight:null,maxRight:null,minTop:null,maxTop:null,minBottom:null,maxBottom:null}},checkParentSize(){if(this.parent){const[t,e]=this.getParentSize();this.parentWidth=t,this.parentHeight=e,this.right=this.parentWidth-this.width-this.left,this.bottom=this.parentHeight-this.height-this.top}},getParentSize(){if(this.parent){const t=window.getComputedStyle(this.$el.parentNode,null);return[parseInt(t.getPropertyValue("width"),10),parseInt(t.getPropertyValue("height"),10)]}return[null,null]},elementTouchDown(t){L=E.touch,this.elementDown(t)},elementMouseDown(t){L=E.mouse,this.elementDown(t)},elementDown(t){if(t instanceof MouseEvent&&1!==t.which)return;const e=t.target||t.srcElement;if(this.$el.contains(e)){if(!1===this.onDragStart(t))return;if(this.dragHandle&&!x(e,this.dragHandle,this.$el)||this.dragCancel&&x(e,this.dragCancel,this.$el))return void(this.dragging=!1);this.enabled||(this.enabled=!0,this.$emit("activated"),this.$emit("update:active",!0)),this.draggable&&(this.dragEnable=!0),this.mouseClickPosition.mouseX=t.touches?t.touches[0].pageX:t.pageX,this.mouseClickPosition.mouseY=t.touches?t.touches[0].pageY:t.pageY,this.mouseClickPosition.left=this.left,this.mouseClickPosition.right=this.right,this.mouseClickPosition.top=this.top,this.mouseClickPosition.bottom=this.bottom,this.parent&&(this.bounds=this.calcDragLimits()),T(document.documentElement,L.move,this.move),T(document.documentElement,L.stop,this.handleUp)}},calcDragLimits(){return{minLeft:this.left%this.grid[0],maxLeft:Math.floor((this.parentWidth-this.width-this.left)/this.grid[0])*this.grid[0]+this.left,minRight:this.right%this.grid[0],maxRight:Math.floor((this.parentWidth-this.width-this.right)/this.grid[0])*this.grid[0]+this.right,minTop:this.top%this.grid[1],maxTop:Math.floor((this.parentHeight-this.height-this.top)/this.grid[1])*this.grid[1]+this.top,minBottom:this.bottom%this.grid[1],maxBottom:Math.floor((this.parentHeight-this.height-this.bottom)/this.grid[1])*this.grid[1]+this.bottom}},deselect(t){const e=t.target||t.srcElement,i=new RegExp(this.className+"-([trmbl]{2})","");this.$el.contains(e)||i.test(e.className)||(this.enabled&&!this.preventDeactivation&&(this.enabled=!1,this.$emit("deactivated"),this.$emit("update:active",!1)),A(document.documentElement,L.move,this.handleResize)),this.resetBoundsAndMouseState()},handleTouchDown(t,e){L=E.touch,this.handleDown(t,e)},handleDown(t,e){e instanceof MouseEvent&&1!==e.which||!1!==this.onResizeStart(t,e)&&(e.stopPropagation&&e.stopPropagation(),this.lockAspectRatio&&!t.includes("m")?this.handle="m"+t.substring(1):this.handle=t,this.resizeEnable=!0,this.mouseClickPosition.mouseX=e.touches?e.touches[0].pageX:e.pageX,this.mouseClickPosition.mouseY=e.touches?e.touches[0].pageY:e.pageY,this.mouseClickPosition.left=this.left,this.mouseClickPosition.right=this.right,this.mouseClickPosition.top=this.top,this.mouseClickPosition.bottom=this.bottom,this.bounds=this.calcResizeLimits(),T(document.documentElement,L.move,this.handleResize),T(document.documentElement,L.stop,this.handleUp))},calcResizeLimits(){let t=this.minW,e=this.minH,i=this.maxW,n=this.maxH;const s=this.aspectFactor,[r,a]=this.grid,o=this.width,h=this.height,l=this.left,c=this.top,u=this.right,d=this.bottom;this.lockAspectRatio&&(t/e>s?e=t/s:t=s*e,i&&n?(i=Math.min(i,s*n),n=Math.min(n,i/s)):i?n=i/s:n&&(i=s*n)),i-=i%r,n-=n%a;const m={minLeft:null,maxLeft:null,minTop:null,maxTop:null,minRight:null,maxRight:null,minBottom:null,maxBottom:null};return this.parent?(m.minLeft=l%r,m.maxLeft=l+Math.floor((o-t)/r)*r,m.minTop=c%a,m.maxTop=c+Math.floor((h-e)/a)*a,m.minRight=u%r,m.maxRight=u+Math.floor((o-t)/r)*r,m.minBottom=d%a,m.maxBottom=d+Math.floor((h-e)/a)*a,i&&(m.minLeft=Math.max(m.minLeft,this.parentWidth-u-i),m.minRight=Math.max(m.minRight,this.parentWidth-l-i)),n&&(m.minTop=Math.max(m.minTop,this.parentHeight-d-n),m.minBottom=Math.max(m.minBottom,this.parentHeight-c-n)),this.lockAspectRatio&&(m.minLeft=Math.max(m.minLeft,l-c*s),m.minTop=Math.max(m.minTop,c-l/s),m.minRight=Math.max(m.minRight,u-d*s),m.minBottom=Math.max(m.minBottom,d-u/s))):(m.minLeft=null,m.maxLeft=l+Math.floor((o-t)/r)*r,m.minTop=null,m.maxTop=c+Math.floor((h-e)/a)*a,m.minRight=null,m.maxRight=u+Math.floor((o-t)/r)*r,m.minBottom=null,m.maxBottom=d+Math.floor((h-e)/a)*a,i&&(m.minLeft=-(u+i),m.minRight=-(l+i)),n&&(m.minTop=-(d+n),m.minBottom=-(c+n)),this.lockAspectRatio&&i&&n&&(m.minLeft=Math.min(m.minLeft,-(u+i)),m.minTop=Math.min(m.minTop,-(n+d)),m.minRight=Math.min(m.minRight,-l-i),m.minBottom=Math.min(m.minBottom,-c-n))),m},move(t){this.resizing?this.handleResize(t):this.dragEnable&&this.handleDrag(t)},handleDrag(t){t.preventDefault(),t.stopPropagation();const e=this.axis,i=this.grid,n=this.bounds,s=this.mouseClickPosition,r=e&&"y"!==e?s.mouseX-(t.touches?t.touches[0].pageX:t.pageX):0,a=e&&"x"!==e?s.mouseY-(t.touches?t.touches[0].pageY:t.pageY):0,[o,h]=y(i,r,a,this.scale),l=w(s.left-o,n.minLeft,n.maxLeft),c=w(s.top-h,n.minTop,n.maxTop);if(!1===this.onDrag(l,c))return;const u=w(s.right+o,n.minRight,n.maxRight),d=w(s.bottom+h,n.minBottom,n.maxBottom);this.left=l,this.top=c,this.right=u,this.bottom=d,this.$emit("dragging",this.left,this.top),this.dragging=!0},moveHorizontally(t){const[e]=y(this.grid,t,this.top,1),i=w(e,this.bounds.minLeft,this.bounds.maxLeft);this.left=i,this.right=this.parentWidth-this.width-i},moveVertically(t){const[,e]=y(this.grid,this.left,t,1),i=w(e,this.bounds.minTop,this.bounds.maxTop);this.top=i,this.bottom=this.parentHeight-this.height-i},handleResize(t){let e=this.left,i=this.top,n=this.right,s=this.bottom;const r=this.mouseClickPosition,a=this.aspectFactor,o=r.mouseX-(t.touches?t.touches[0].pageX:t.pageX),h=r.mouseY-(t.touches?t.touches[0].pageY:t.pageY);!this.widthTouched&&o&&(this.widthTouched=!0),!this.heightTouched&&h&&(this.heightTouched=!0);const[l,c]=y(this.grid,o,h,this.scale);this.handle.includes("b")?(s=w(r.bottom+c,this.bounds.minBottom,this.bounds.maxBottom),this.lockAspectRatio&&this.resizingOnY&&(n=this.right-(this.bottom-s)*a)):this.handle.includes("t")&&(i=w(r.top-c,this.bounds.minTop,this.bounds.maxTop),this.lockAspectRatio&&this.resizingOnY&&(e=this.left-(this.top-i)*a)),this.handle.includes("r")?(n=w(r.right+l,this.bounds.minRight,this.bounds.maxRight),this.lockAspectRatio&&this.resizingOnX&&(s=this.bottom-(this.right-n)/a)):this.handle.includes("l")&&(e=w(r.left-l,this.bounds.minLeft,this.bounds.maxLeft),this.lockAspectRatio&&this.resizingOnX&&(i=this.top-(this.left-e)/a));const u=v(this.parentWidth,e,n),d=b(this.parentHeight,i,s);!1!==this.onResize(this.handle,e,i,u,d)&&(this.left=e,this.top=i,this.right=n,this.bottom=s,this.width=u,this.height=d,this.$emit("resizing",this.left,this.top,this.width,this.height),this.resizing=!0)},changeWidth(t){const[e]=y(this.grid,t,0,1);let i=w(this.parentWidth-e-this.left,this.bounds.minRight,this.bounds.maxRight),n=this.bottom;this.lockAspectRatio&&(n=this.bottom-(this.right-i)/this.aspectFactor);const s=v(this.parentWidth,this.left,i),r=b(this.parentHeight,this.top,n);this.right=i,this.bottom=n,this.width=s,this.height=r},changeHeight(t){const[,e]=y(this.grid,0,t,1);let i=w(this.parentHeight-e-this.top,this.bounds.minBottom,this.bounds.maxBottom),n=this.right;this.lockAspectRatio&&(n=this.right-(this.bottom-i)*this.aspectFactor);const s=v(this.parentWidth,this.left,n),r=b(this.parentHeight,this.top,i);this.right=n,this.bottom=i,this.width=s,this.height=r},handleUp(){this.handle=null,this.resetBoundsAndMouseState(),this.dragEnable=!1,this.resizeEnable=!1,this.resizing&&(this.resizing=!1,this.$emit("resizestop",this.left,this.top,this.width,this.height)),this.dragging&&(this.dragging=!1,this.$emit("dragstop",this.left,this.top)),A(document.documentElement,L.move,this.handleResize)}},computed:{style(){return{transform:`translate(${this.left}px, ${this.top}px)`,width:this.computedWidth,height:this.computedHeight,zIndex:this.zIndex,...this.dragging&&this.disableUserSelect?P:R}},actualHandles(){return this.resizable?this.handles:[]},computedWidth(){return"auto"!==this.w||this.widthTouched?this.width+"px":"auto"},computedHeight(){return"auto"!==this.h||this.heightTouched?this.height+"px":"auto"},resizingOnX(){return Boolean(this.handle)&&(this.handle.includes("l")||this.handle.includes("r"))},resizingOnY(){return Boolean(this.handle)&&(this.handle.includes("t")||this.handle.includes("b"))},isCornerHandle(){return Boolean(this.handle)&&["tl","tr","br","bl"].includes(this.handle)}},watch:{active(t){this.enabled=t,t?this.$emit("activated"):this.$emit("deactivated")},z(t){(t>=0||"auto"===t)&&(this.zIndex=t)},x(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcDragLimits()),this.moveHorizontally(t))},y(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcDragLimits()),this.moveVertically(t))},lockAspectRatio(t){this.aspectFactor=t?this.width/this.height:void 0},minWidth(t){t>0&&t<=this.width&&(this.minW=t)},minHeight(t){t>0&&t<=this.height&&(this.minH=t)},maxWidth(t){this.maxW=t},maxHeight(t){this.maxH=t},w(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcResizeLimits()),this.changeWidth(t))},h(t){this.resizing||this.dragging||(this.parent&&(this.bounds=this.calcResizeLimits()),this.changeHeight(t))}}},z=i(89);const C=(0,z.Z)(k,[["render",p]]);var B=C,M=i(2621),_=i(62),D=i(6169),W={setup(){return{appStore:(0,M.q)(),bannersStore:(0,_.i)(),toaster:(0,D.P)()}},data:()=>({isTextEditMode:!1}),props:{id:{type:String},zoom:{type:Number},editable:{type:Boolean,default:!1},banner:{type:Object,required:!0},canvas:{type:Object,required:!0},scheme:{type:String}},methods:{async init(){document.addEventListener("keydown",this._keyListener)},enterTextEditMode(t){if(this.isTextEditMode||!this.editable)return;this.isTextEditMode=!0;const e=t.target.closest(".canvas_text").querySelector("textarea");this.$nextTick((()=>{e.select()}))},_keyListener(t){const{key:e,shiftKey:i,target:{tagName:n}}=t,s="INPUT"===n||"TEXTAREA"===n;switch(e){case"Escape":this.activeLayer&&!s&&this.bannersStore.deactivateLayer(this.activeLayer);break;case"Backspace":case"Delete":this.activeLayer&&!s&&this.bannersStore.deleteLayer(this.activeLayer);break;case"ArrowUp":case"ArrowRight":case"ArrowDown":case"ArrowLeft":this.activeLayer&&!s&&(t.preventDefault(),this.bannersStore.shiftLayer(this.activeLayer,e.slice(5).toLowerCase(),i));break;default:break}}},computed:{layers(){return this.banner.layers.map((t=>t)).reverse()},activeLayer(){return this.bannersStore.activeLayer}},mounted(){this.init()},beforeUnmount(){document.removeEventListener("keydown",this._keyListener)},components:{BannerCopyright:m.Z,VueDraggableResizable:B}};const H=(0,z.Z)(W,[["render",d],["__scopeId","data-v-141a0cfc"]]);var N=H},205:function(t,e,i){"use strict";i.d(e,{Z:function(){return u}});var n=i(3396),s=i(7139);const r=t=>((0,n.dD)("data-v-5251ae98"),t=t(),(0,n.Cn)(),t),a=r((()=>(0,n._)("div",{class:"banner_copyright_info"},[(0,n._)("div",{class:"banner_copyright_info_title"},"Сервис готовых баннеров"),(0,n._)("div",{class:"banner_copyright_info_link"},"www.ai-banner.com")],-1)));function o(t,e,i,r,o,h){const l=(0,n.up)("AppIcon");return(0,n.wg)(),(0,n.iD)("div",{class:(0,s.C_)(["banner_copyright",[`banner_copyright--${i.variant}`]])},[(0,n.Wm)(l,{icon:"logo",size:16,class:"banner_copyright_logo"}),a],2)}var h={props:{variant:{type:String,default:"light"}}},l=i(89);const c=(0,l.Z)(h,[["render",o],["__scopeId","data-v-5251ae98"]]);var u=c}}]);
//# sourceMappingURL=564.ff84e7a3.js.map