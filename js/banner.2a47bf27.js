"use strict";(self["webpackChunkunicorn_banners"]=self["webpackChunkunicorn_banners"]||[]).push([[392],{9946:function(e,s,r){r.r(s),r.d(s,{default:function(){return w}});var t=r(3396);const n={class:"banner"},a={class:"main_column"},i={class:"banner_demo",ref:"bannerDemo"},o={key:0,class:"banner_demo_wrapper"};function c(e,s,r,c,h,u){const d=(0,t.up)("BannerCanvas");return(0,t.wg)(),(0,t.iD)("div",n,[(0,t._)("div",a,[(0,t._)("div",i,["success"===u.bannerStatus?((0,t.wg)(),(0,t.iD)("div",o,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(u.canvases,(s=>((0,t.wg)(),(0,t.j4)(d,{key:s.title,canvas:s,scheme:u.banner?.schemes[0]?.id,banner:u.banner,zoom:e.bannerDemoWidth/s.width,ref_for:!0,ref:"canvas"},null,8,["canvas","scheme","banner","zoom"])))),128))])):(0,t.kq)("",!0)],512)])])}var h=r(2613),u=r.n(h),d=r(5995),b=r(2621),l=r(5553),m=r(62),v=r(6169),p=r(2037),g={setup(){return{appStore:(0,b.q)(),categoriesStore:(0,l.x)(),bannersStore:(0,m.i)(),toaster:(0,v.P)()}},data:()=>({zoom:1,uploadProgress:0,isSubmitting:!1,isSubmitSuccess:"",bannerDemoWidth:0,bannerDemoResizeObserver:null}),props:["id"],methods:{async getBanner(){try{await this.bannersStore.getBanner(this.id)}catch(e){console.error(e),this.toaster.error("Не получилось загрузить баннер :(")}},addColorScheme(e){this.bannersStore.addColorScheme(e,this.$refs.schemes)},selectCanvas(e){this.bannersStore.setCanvasId(e),this.$nextTick((()=>{this.scrollToCanvasCenter()}))},async submit(){if(this.isSubmitting)return;const{conversion:e,category:s,userGroup:r,canvases:t,schemes:n,layers:a,files:i}=this.banner;try{this.isSubmitting=!0,this.uploadProgress=1;const o={onUploadProgress:e=>{const s=Math.round(100*e.loaded/e.total);this.uploadProgress=s>98?98:s}},c=this.$refs.canvas[0].$el.querySelector(".canvas"),h=await u().toPng(c,{}),d={files:i,conversion:e,preview:h.split(",")[1],category_id:s?.value,is_premium:"premium"===r?.value,data:{canvases:t,schemes:n,layers:a}};this.id?(d.id=this.id,await p.Z.banners.update(d,o),this.toaster.success("Изменения сохранены!")):(await p.Z.banners.create(d,o),this.$router.push({name:"adminBanners"}),this.toaster.success("Баннер добавлен!"))}catch(o){console.log(o),this.toaster.error("Не получилось сохранить :(")}finally{this.isSubmitting=!1,this.uploadProgress=0}},async init(){this.appStore.toggleAppLoader(!0),this.id?await this.getBanner():this.bannersStore.setUserGroup(0);const e=this.$refs.canvas[0].$el.querySelector(".canvas_preload");await u().toPng(e),this.bannerDemoResizeObserver=new ResizeObserver((e=>{for(let s of e)this.bannerDemoWidth=s.contentRect.width})),this.bannerDemoResizeObserver.observe(this.$refs.bannerDemo),setTimeout((()=>{this.appStore.toggleAppLoader(!1)}),135)},changeZoom(e){switch(e){case"=":this.zoom+=.05;break;case"-":this.zoom-=.05;break;default:this.zoom=1}},calculateBannerDemoWidth(){this.bannerDemoWidth=this.$refs.bannerDemo.offsetWidth}},computed:{banner(){return this.bannersStore.banner.data},bannerStatus(){return this.bannersStore.banner.status},currentCanvasId(){return this.bannersStore.currentCanvasId},currentSchemeId(){return this.bannersStore.currentSchemeId},canvases(){return this.bannersStore.canvases},canvas(){return this.bannersStore.canvas},schemes(){return this.bannersStore.schemes},layers(){return this.banner.layers.map((e=>e)).reverse()},activeLayer(){return this.bannersStore.activeLayer},categories(){return this.categoriesStore.categories.data},listCategories(){return this.categories.map((({id:e,name:s})=>({label:s,value:e})))}},mounted(){this.init(),this.calculateBannerDemoWidth()},beforeUnmount(){this.bannerDemoResizeObserver.disconnect()},components:{BannerCanvas:d.Z},watch:{categories:{deep:!0,immediate:!0,handler(){this.banner.category=this.listCategories[0]}}}},S=r(89);const f=(0,S.Z)(g,[["render",c],["__scopeId","data-v-bf4f304e"]]);var w=f}}]);
//# sourceMappingURL=banner.2a47bf27.js.map